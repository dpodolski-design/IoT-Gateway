# 01 — Обзор и назначение

## Назначение проекта

**IoT Gateway** — прототип модуля интеграции платформы TAS (Telephony Application Server) с системами умного дома. Модуль обеспечивает:

- **Телеком → IoT:** доставка уведомлений о входящих звонках на устройства умного дома (умные колонки).
- **IoT → Телеком:** инициация звонков по событиям от устройств умного дома (например, срабатывание датчика дыма → звонок на заданный номер через FreeSWITCH).

Прототип призван подтвердить жизнеспособность архитектуры и дать основу для последующего развития (SMS на колонки, домофон, носимые устройства и т.д.).

## Границы прототипа

**Входит в прототип:**

- Регистрация устройств типов `speaker` и `sensor_smoke`, привязка к номеру (MSISDN).
- Сценарий «входящий звонок → уведомление на колонку» (в т.ч. симуляция через REST).
- Сценарий «событие smoke → исходящий звонок» по правилу (webhook + FreeSWITCH или mock).
- REST API для устройств, правил, логов; приём webhook с проверкой API key.
- Логирование событий в БД (`event_logs`).

**Не входит в прототип:**

- Входящая SMS на колонку, домофон, умный браслет.
- Поддержка нескольких вендоров и протоколов умного дома (Matter, Zigbee).
- OAuth2/JWT, очереди (Kafka/RabbitMQ), production-мониторинг и биллинг.

## Термины

| Термин | Описание |
|--------|----------|
| **TAS** | Telephony Application Server — платформа телефонии (Kamailio, FreeSWITCH, PostgreSQL). |
| **Device** | Устройство умного дома, зарегистрированное в модуле (колонка, датчик дыма). |
| **Device Registry** | Реестр устройств: привязка device_id, типа, MSISDN, endpoint для уведомлений. |
| **Rule** | Правило: при событии определённого типа от устройства выполнить действие (например, звонок на номер). |
| **MSISDN** | Номер телефона абонента (для привязки колонки к номеру). |
| **Webhook** | HTTP POST от системы умного дома с событием (event_type, device_id). |
| **Originate** | Команда FreeSWITCH на инициацию исходящего вызова. |

## Стек технологий

- **Python 3.11+**, **FastAPI** — REST API.
- **PostgreSQL** — хранение устройств, правил и логов событий.
- **SQLAlchemy 2 (async)** — работа с БД.
- **FreeSWITCH** — инициация звонков (REST или ESL); при отсутствии — режим mock.
